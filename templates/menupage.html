{% extends "base.html" %}
{% block title %}Menu - Cafe{% endblock %}

{% block content %}
<div class="container my-5">
    <h1 class="text-center mb-5 fw-bold" style="color:#333;">Our Menu ☕</h1>

    <!-- Category Tabs -->
    <ul class="nav nav-pills mb-4 justify-content-center" id="categoryTabs">
        <li class="nav-item">
            <a class="nav-link active" data-category="all" href="#">All</a>
        </li>
        {% for category in categories %}
        <li class="nav-item">
            <a class="nav-link" data-category="{{ category.id }}" href="#">{{ category.name }}</a>
        </li>
        {% endfor %}
    </ul>

    <!-- Items -->
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5 g-4" id="menuItems">
        {% for item in all_items %}
        <div class="col menu-item" data-category="{{ item.menu.id }}">
            <div class="card h-100 shadow-lg rounded-4 border-0 position-relative item-card" style="transition: transform 0.3s, box-shadow 0.3s;">
                {% if item.image %}
                    <img src="{{ item.image.url }}" class="card-img-top rounded-4" alt="{{ item.name }}" style="height:200px; object-fit:cover;">
                {% else %}
                    <img src="https://via.placeholder.com/300x200?text={{ item.name }}" class="card-img-top rounded-4" alt="{{ item.name }}" style="height:200px; object-fit:cover;">
                {% endif %}

                <div class="card-body text-center">
                    <h6 class="badge bg-warning text-dark mb-2">{{ item.menu.name }}</h6>
                    <h5 class="card-title fw-bold">{{ item.name }}</h5>
                    <p class="text-danger fw-bold fs-5">₹{{ item.price }}</p>

                    <!-- Quantity Selector -->
                    <div class="d-flex justify-content-center align-items-center gap-2 mb-3">
                        <button class="btn btn-outline-secondary btn-sm qty-decrease" data-id="{{ item.id }}">-</button>
                        <input type="text" value="1" min="1" class="form-control text-center qty-input" style="width:50px;" data-id="{{ item.id }}">
                        <button class="btn btn-outline-secondary btn-sm qty-increase" data-id="{{ item.id }}">+</button>
                    </div>

                    <div class="d-flex justify-content-center gap-2">
                        <a href="{% url 'order_page' %}?item_id={{ item.id }}&qty=1" class="btn btn-danger btn-sm fw-bold order-btn" data-id="{{ item.id }}">Order Now</a>
                        <a href="{% url 'menu_details' item.id %}" class="btn btn-outline-secondary btn-sm">Details</a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // Card hover animation
    const itemCards = document.querySelectorAll('.item-card');
    itemCards.forEach(card => {
        card.addEventListener('mouseenter', () => {
            card.style.transform = 'translateY(-8px)';
            card.style.boxShadow = '0 15px 35px rgba(0,0,0,0.2)';
        });
        card.addEventListener('mouseleave', () => {
            card.style.transform = 'translateY(0)';
            card.style.boxShadow = '0 4px 8px rgba(0,0,0,0.1)';
        });
    });

    // Quantity increase/decrease
    const increaseBtns = document.querySelectorAll('.qty-increase');
    const decreaseBtns = document.querySelectorAll('.qty-decrease');
    const qtyInputs = document.querySelectorAll('.qty-input');
    const orderBtns = document.querySelectorAll('.order-btn');

    increaseBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const id = btn.dataset.id;
            const input = document.querySelector(`.qty-input[data-id='${id}']`);
            input.value = parseInt(input.value) + 1;
            updateOrderLink(id);
        });
    });

    decreaseBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const id = btn.dataset.id;
            const input = document.querySelector(`.qty-input[data-id='${id}']`);
            if (parseInt(input.value) > 1) {
                input.value = parseInt(input.value) - 1;
                updateOrderLink(id);
            }
        });
    });

    qtyInputs.forEach(input => {
        input.addEventListener('input', () => {
            if (parseInt(input.value) < 1 || isNaN(input.value)) input.value = 1;
            updateOrderLink(input.dataset.id);
        });
    });

    function updateOrderLink(id) {
        const qty = document.querySelector(`.qty-input[data-id='${id}']`).value;
        const orderBtn = document.querySelector(`.order-btn[data-id='${id}']`);
        orderBtn.href = `{% url 'order_page' %}?item_id=${id}&qty=${qty}`;
    }

    // Category filter
    const tabs = document.querySelectorAll('#categoryTabs .nav-link');
    const items = document.querySelectorAll('.menu-item');

    tabs.forEach(tab => {
        tab.addEventListener('click', (e) => {
            e.preventDefault();
            tabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');

            const category = tab.dataset.category;
            items.forEach(item => {
                if(category === 'all' || item.dataset.category === category) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        });
    });
</script>
{% endblock %}

<style>
    .nav-pills .nav-link.active {
        background-color: #FF6F61;
        color: white;
    }
    .item-card {
        transition: transform 0.3s, box-shadow 0.3s;
    }
    .menu-item {
        transition: all 0.3s;
    }
</style>
