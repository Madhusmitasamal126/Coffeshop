{% extends "base.html" %}
{% block title %}Menu - Cafe{% endblock %}

{% block content %}
<div class="container my-5">
    <h1 class="text-center mb-5 fw-bold text-coffee">Our Menu ☕</h1>

    {% for category in categories %}
    <section class="mb-5">
        <!-- Category Name -->
        <h3 class="fw-bold mb-4 text-coffee text-center">{{ category.name }}</h3>

        <!-- Items for this category -->
        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5 g-4">
            {% for item in all_items %}
                {% if item.menu.id == category.id %}
                <div class="col">
                    <div class="card h-100 shadow rounded-4 border-0 position-relative item-card" style="overflow: hidden; background: #fff7f0;">
                        {% if item.image %}
                            <img src="{{ item.image.url }}" class="card-img-top" alt="{{ item.name }}" style="height:200px; object-fit:cover; transition: transform 0.4s;">
                        {% else %}
                            <img src="https://via.placeholder.com/300x200?text={{ item.name }}" class="card-img-top" alt="{{ item.name }}" style="height:200px; object-fit:cover; transition: transform 0.4s;">
                        {% endif %}

                        <div class="card-body text-center">
                            <!-- Centered Badge -->
                            <h6 class="badge rounded-pill mb-2 px-3 py-1 text-dark d-block mx-auto" style="background-color:#D9B99B;">{{ category.name }}</h6>

                            <h5 class="card-title fw-bold">{{ item.name }}</h5>
                            <p class="text-coffee fw-bold fs-5">₹{{ item.price }}</p>

                            <!-- Quantity Selector -->
                            <div class="d-flex justify-content-center align-items-center gap-2 mb-3 mt-2">
                                <button class="btn btn-outline-coffee btn-sm qty-decrease" data-id="{{ item.id }}">-</button>
                                <input type="text" value="1" min="1" class="form-control text-center qty-input" style="width:50px;" data-id="{{ item.id }}">
                                <button class="btn btn-outline-coffee btn-sm qty-increase" data-id="{{ item.id }}">+</button>
                            </div>

                            <div class="d-flex justify-content-center gap-2">
                                <a href="{% url 'order_page' %}?item_id={{ item.id }}&qty=1" class="btn btn-coffee btn-sm fw-bold order-btn" data-id="{{ item.id }}">Order Now</a>
                                <a href="{% url 'menu_details' item.id %}" class="btn btn-outline-coffee btn-sm">Details</a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
            {% endfor %}
        </div>
    </section>
    {% endfor %}
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // Card hover animation
    const itemCards = document.querySelectorAll('.item-card');
    itemCards.forEach(card => {
        card.addEventListener('mouseenter', () => {
            card.style.transform = 'translateY(-10px)';
            card.style.boxShadow = '0 20px 40px rgba(0,0,0,0.2)';
            card.querySelector('img').style.transform = 'scale(1.05)';
        });
        card.addEventListener('mouseleave', () => {
            card.style.transform = 'translateY(0)';
            card.style.boxShadow = '0 6px 12px rgba(0,0,0,0.1)';
            card.querySelector('img').style.transform = 'scale(1)';
        });
    });

    // Quantity increase/decrease
    const increaseBtns = document.querySelectorAll('.qty-increase');
    const decreaseBtns = document.querySelectorAll('.qty-decrease');
    const qtyInputs = document.querySelectorAll('.qty-input');
    const orderBtns = document.querySelectorAll('.order-btn');

    increaseBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const id = btn.dataset.id;
            const input = document.querySelector(`.qty-input[data-id='${id}']`);
            input.value = parseInt(input.value) + 1;
            updateOrderLink(id);
        });
    });

    decreaseBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const id = btn.dataset.id;
            const input = document.querySelector(`.qty-input[data-id='${id}']`);
            if (parseInt(input.value) > 1) {
                input.value = parseInt(input.value) - 1;
                updateOrderLink(id);
            }
        });
    });

    qtyInputs.forEach(input => {
        input.addEventListener('input', () => {
            if (parseInt(input.value) < 1 || isNaN(input.value)) input.value = 1;
            updateOrderLink(input.dataset.id);
        });
    });

    function updateOrderLink(id) {
        const qty = document.querySelector(`.qty-input[data-id='${id}']`).value;
        const orderBtn = document.querySelector(`.order-btn[data-id='${id}']`);
        orderBtn.href = `{% url 'order_page' %}?item_id=${id}&qty=${qty}`;
    }
</script>
{% endblock %}

<style>
:root {
    --coffee-dark: #4B2E2B;
    --coffee-medium: #7B4F45;
    --coffee-light: #D9B99B;
}

.text-coffee { color: var(--coffee-dark); }

.btn-coffee {
    background-color: var(--coffee-medium);
    color: var(--coffee-light);
    border: none;
    transition: transform 0.3s, background-color 0.3s;
}
.btn-coffee:hover {
    background-color: var(--coffee-dark);
    transform: translateY(-2px);
    color: var(--coffee-light);
}
.btn-outline-coffee {
    border: 1px solid var(--coffee-dark);
    color: var(--coffee-dark);
}
.btn-outline-coffee:hover {
    background-color: var(--coffee-dark);
    color: var(--coffee-light);
}

.item-card { 
    border-radius: 12px; 
    overflow: hidden; 
    transition: all 0.3s; 
}
section { 
    border-bottom: 2px solid #D9B99B; 
    padding-bottom: 40px; 
}
</style>
